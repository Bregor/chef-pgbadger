#+TITLE: PgBadger Cookbook
#+OPTIONS: toc:nil num:nil ^:nil

* PgBadger Cookbook
  Installs/configures [[http://dalibo.github.io/pgbadger/][PgBadger]]

** Requirements

** packages
  - =perl= - pgbadger needs only perl to run

** cookbooks
   - =cron=
   - =apt=

** Attributes
*** pgbadger::default
|-----------------------+--------+---------------------------------------------------------------------------+----------------------------------------------------------------------------------------------|
| Key                   | Type   | Description                                                               | Default                                                                                      |
|-----------------------+--------+---------------------------------------------------------------------------+----------------------------------------------------------------------------------------------|
| [pgbadger][databases] | Array  | List of databases to perform.                                             | []                                                                                           |
| [pgbadger][data_dir]  | String | Path for generated reports                                                | "/var/www/pgbadger"                                                                          |
| [pgbadger][log_path]  | String | Path to PostgreSQL log                                                    | "/var/log/postgresql/postgresql-#{node[:postgresql][:defaults][:server][:version]}-main.log" |
| [pgbadger][rhytm]     | String | Periodicity of reports generation. E.g. =horly=, =daily=, =monthly=, etc. | "hourly"                                                                                     |
| [pgbadger][user]      | String | Reports owner                                                             | "root"                                                                                       |
|-----------------------+--------+---------------------------------------------------------------------------+----------------------------------------------------------------------------------------------|

** Usage
*** pgbadger::install
Just include =pgbadger::install= in your node's =run_list=:

#+BEGIN_SRC javascript
{
  "name":"my_node",
  "run_list": [
    "recipe[pgbadger::install]"
  ]
}
#+END_SRC

*** pgbadger::default
Include =pgbadger= in your node's =run_list= and add list of databases to node attributes:

#+BEGIN_SRC javascript
{
  "name":"my_node",
  "pgbadger":{"databases":["lucifer","antropolog"]}, //thanks to Nate for naming
  "run_list": [
    "recipe[pgbadger]"
  ]
}
#+END_SRC


** Contributing
1. Fork the repository on Github
2. Create a named feature branch (like `add_component_x`)
3. Write your change
4. Write tests for your change (if applicable)
5. Run the tests, ensuring they all pass
6. Submit a Pull Request using Github

** Special thanks
   Sponsored by [[http://evilmartians.com][Evil Martians]]
** Authors
   - Maxim Filatov <bregor@evilmartians.com>
